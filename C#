using System;
using System.Collections.Generic;
using System.IO;
using System.Linq;

class Program
{
    // Lista predmeta koja se koristi za unos ocjena
    static List<string> predmeti = new List<string> {
        "matematika", "hrvatski", "engleski", "tjelesni", "programiranje", "webdizajn", "bazapodataka"
    };

    static void Main()
    {
        while (true)
        {
            // Ispisivanje opcija izbornika
            Console.WriteLine("Odaberite opciju:");
            Console.WriteLine("1. Ispis svih ucenika");
            Console.WriteLine("2. Unos novih ocjena");
            Console.WriteLine("3. Pretraga ucenika po ocjeni i predmetu");
            Console.WriteLine("4. Izlaz");

            int opcija;
            // Provjera ispravnosti unosa opcije
            while (!int.TryParse(Console.ReadLine(), out opcija) || opcija < 1 || opcija > 4)
            {
                Console.WriteLine("Molimo unesite broj 1, 2, 3 ili 4.");
            }

            if (opcija == 1)
            {
                // Prikaz svih ucenika
                IspisUcenika();
            }
            else if (opcija == 2)
            {
                // Unos ocjena za određenog ucenika
                Console.WriteLine("Unesite ime ucenika:");
                string ime = Console.ReadLine();

                UnosOcjena(ime);
            }
            else if (opcija == 3)
            {
                // Pretraga ucenika po predmetu i ocjeni
                PretragaUcenika();
            }
            else if (opcija == 4)
            {
                // Izlaz iz programa
                break;
            }
        }
    }

    static void IspisUcenika()
    {
        // Čitanje svih linija iz datoteke "ucenici.txt" i ispisivanje svake linije
        string[] linije = File.ReadAllLines("ucenici.txt");
        foreach (string linija in linije)
        {
            Console.WriteLine(linija);
        }
    }

    static void UnosOcjena(string ime)
    {
        // Dodavanje novih ocjena u datoteku "ucenici.txt" za određenog ucenika
        using (StreamWriter sw = File.AppendText("ucenici.txt"))
        {
            foreach (string predmet in predmeti)
            {
                // Unos ocjene za svaki predmet
                Console.WriteLine($"Unesite ocjenu iz {predmet}:");
                int ocjena;
                // Provjera ispravnosti unosa ocjene
                while (!int.TryParse(Console.ReadLine(), out ocjena) || ocjena < 1 || ocjena > 5)
                {
                    Console.WriteLine("Molimo unesite broj izmedu 1 i 5.");
                }

                // Zapisivanje ocjene u formatu "ime, predmet, ocjena" u datoteku
                sw.WriteLine($"{ime}, {predmet}, {ocjena}");
            }
        }
    }

    static void PretragaUcenika()
    {
        // Pretraga ucenika po predmetu i ocjeni
        Console.WriteLine("Unesite naziv predmeta za pretragu:");
        string predmetPretraga = Console.ReadLine().ToLower();

        // Provjera postojanja unesenog predmeta u listi predmeta
        if (!predmeti.Contains(predmetPretraga))
        {
            Console.WriteLine("Uneseni predmet ne postoji.");
            return;
        }

        Console.WriteLine("Unesite ocjenu za pretragu:");
        int ocjenaPretraga;
        // Provjera ispravnosti unosa ocjene
        while (!int.TryParse(Console.ReadLine(), out ocjenaPretraga) || ocjenaPretraga < 1 || ocjenaPretraga > 5)
        {
            Console.WriteLine("Molimo unesite broj izmedu 1 i 5.");
        }

        // Čitanje linija iz datoteke "ucenici.txt" i filtriranje rezultata prema unesenom predmetu i ocjeni
        string[] linije = File.ReadAllLines("ucenici.txt");
        var rezultati = linije.Where(line => line.Contains($"{predmetPretraga}, {ocjenaPretraga}"));
        
        // Ispis rezultata pretrage, ako postoje, inače ispis poruke da nema rezultata
        if (rezultati.Any())
        {
            Console.WriteLine("Rezultati pretrage:");
            foreach (var rezultat in rezultati)
            {
                Console.WriteLine(rezultat);
            }
        }
        else
        {
            Console.WriteLine("Nema rezultata za zadane kriterije pretrage.");
        }
    }
}
